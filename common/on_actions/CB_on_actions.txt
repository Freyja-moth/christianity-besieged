#When adding effects directly in on_actions always consider if it would be best to do so through a scripted effect. on_actions with a lot of script in them are harder to get an overview of.

# country
on_startup = {
	if = {
		limit = {
			current_age = age_of_discovery
		}
		LXA = {
			if = {
				limit = {
					NOT = { has_country_flag = lxa_loyalty_flag }
				}
				add_estate_loyalty = {
					estate = estate_church
					loyalty = -10
				}
				set_country_flag = lxa_loyalty_flag
			}
		}
	}
	if = {
		limit = { religion = druidism }
		set_estate_privilege = estate_druids_land_consecration
		set_estate_privilege = estate_druids_leading_sacred_rituals
		set_estate_privilege = estate_druids_supremacy_of_court
		set_estate_privilege = estate_druids_legal_immunity
		set_estate_privilege = estate_druids_sacred_armies
	}
	emperor = {
		save_global_event_target_as = Emperor
	}
	if = {
		limit = {
			is_emperor_of_china = yes
		}
		save_global_event_target_as = EmperorOfChina
	}
	events = {
		muslim_school_events.20 #Pick School
		CBFlavorEvents.3 #Neotelete Ritual (Orphism, Christianity Besieged)
		sebkhEvents.0 #Spah Burzafrah's Unstoppable Will
		iskandaria.8 #Council of Iskandaria
		fulofun.0 #Fulo starting event
		armoricaCoup.0 #Armorica Coup Warning
		athyubia.0 #What's Ethiopia called again?
		CBFlavorEvents.12 #Orase Rumana event
		manidoom.1 #Darkness Mechanic introduction
	}
	if = {
		limit = {
			has_roman_religion = yes
		}
		set_variable = {
			which = TemplumFidemarxes
			value = 0
		}
	}
	1 = {
		set_variable = {
    			which = settlerScore
   			value = 0
		}
	}
	if = {
		limit = {
			has_dlc = "Cradle of Civilization"
			has_country_modifier = tur_janissary
		}
		remove_country_modifier = tur_janissary
	}
	initialize_schools_effect = yes #This is only used here but is used for readability of on_action file.
	if = {
		limit = {
			exists = SUK
		}
		SUK = {
			set_ruler_flag = suk_monarch_flag
		}
		AYU = {
			set_country_flag = ayu_monarch_flag
		}
	}
}

# country
on_religion_change = {
	on_religion_change_estate_privileges_effect = yes
	###removes catholic modifiers
		remove_country_modifier = counter_reformation
		remove_country_modifier = the_statue_in_restraint_of_appeals
		remove_country_modifier = revocation_of_restraint_of_appeals
		remove_country_modifier = bavarian_jesuits
		remove_country_modifier = the_societas_jesu
		remove_country_modifier = the_declaration_of_indulgence
		remove_country_modifier = de_heretico_comburendo
		remove_country_modifier = the_conventicle_act
		remove_country_modifier = isilda_reforms
	if = {
		limit = {
			religion = ashabi
			BTA = { has_country_modifier = isilda_reforms }
		}
		add_country_modifier = {
			name = isilda_reforms
			duration = -1
		}
	}
	if = {
		limit = {
			AND = {
				has_roman_religion = yes
				NOT = {
					check_variable = {
						which = TemplumFidemarxes
						value = 1
					}
				}
			}
		}
		set_variable = {
			which = TemplumFidemarxes
			value = 0
		}
	}
	if = {
		limit = {
			has_reform = indian_sultanate_reform
			NOT = { religion_group = muslim }
		}
		remove_government_reform = indian_sultanate_reform
	}
	if = {
		limit = {
			any_owned_province = {
				has_province_modifier = rebellious_christians
			}
			religion_group = christian
		}
		every_owned_province = {
			limit = {
				has_province_modifier = rebellious_christians
			}
			remove_province_modifier = rebellious_christians
		}
	}
	if = {
		limit = {
			has_reform = feudal_theocracy
			NOT = { 
				OR = {
					religion_group = christian
					religion_group = muslim
					religion = zoroastrian
				}
			}
		}
		remove_government_reform = feudal_theocracy
	}
	if = {
		limit = {
			has_darkness = yes
		}
		country_event = { id = manidoom.1 }
	}
	if = {
		limit = {
			government = native
			OR = {
				religion = quetzacoatl
				religion = atzintlicoatl
				religion = mesoamerican_religion
				religion = inti
			}
		}
		change_government = monarchy
		add_government_reform = autocracy_reform
	}


	if = {
		limit = {
			has_heir = yes
		}
		set_heir_religion = ROOT
	}
	if = {
		limit = {
			has_regency = no
		}
		set_ruler_religion = ROOT
	}
	if = {
		limit = {
			has_dlc = "Rights of Man"
			has_consort = yes
		}
		set_consort_religion = ROOT
	}
	if = {
		limit = { has_country_modifier = bav_religious_mandate_mod }
		remove_country_modifier = bav_religious_mandate_mod
	}
	add_country_modifier = {
		name = recently_changed_religion_dummy
		duration = 10
		hidden = yes
	}
	if = {
		limit = {
			NOT = { religion_group = muslim }
			any_owned_province = { has_province_modifier = sufi_shrine }
		}
		every_owned_province = {
			limit = { has_province_modifier = sufi_shrine }
			remove_province_modifier = sufi_shrine
		}
	}
	if = {
		limit = {
			religion = shamanism
			has_country_modifier = son_fetishism_as_secondary_religion
		}
		remove_country_modifier = son_fetishism_as_secondary_religion
		every_owned_province = {
			limit = {
				has_province_modifier = son_fetishism_as_secondary_religion_province
			}
			remove_province_modifier = son_fetishism_as_secondary_religion_province
		}
	}
	events = {
		muslim_school_events.20 #Pick School
		propagate_religion_events.7 #Propagated Country is now Muslim
	}
}

# country.
on_secondary_religion_change = {
	# Done from code: add_prestige = -50 (Define: CHANGE_SECONDARY_PRESTIGE_HIT)
	every_owned_province = {
		limit = { has_province_modifier = tengri_monastic_order }
		remove_province_modifier = tengri_monastic_order
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_shiite_settled_in_capital }
		remove_province_modifier = tengri_shiite_settled_in_capital
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_insincere_leadership }
		remove_province_modifier = tengri_insincere_leadership
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_religious_influx }
		remove_province_modifier = tengri_religious_influx
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_ruler_questioned }
		remove_province_modifier = tengri_ruler_questioned
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_strengthened_local_clans }
		remove_province_modifier = tengri_strengthened_local_clans
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_growing_cities }
		remove_province_modifier = tengri_growing_cities
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_christian_mission }
		remove_province_modifier = tengri_christian_mission
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_unchristian_values }
		remove_province_modifier = tengri_unchristian_values
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_monastic_order }
		remove_province_modifier = tengri_monastic_order
	}
	every_owned_province = {
		limit = { has_province_modifier = hindufication }
		remove_province_modifier = hindufication
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_influx_of_monks }
		remove_province_modifier = tengri_influx_of_monks
	}
	every_owned_province = {
		limit = { has_province_modifier = tengri_abandoning_the_old_ways }
		remove_province_modifier = tengri_abandoning_the_old_ways
	}
	remove_country_modifier = tengri_devout_muslim
	remove_country_modifier = tengri_confucian_elites_alienated
	remove_country_modifier = tengri_confucian_titles
	remove_country_modifier = tengri_traditionalists_strengthened
	remove_country_modifier = tengri_confucian_nobles
	remove_country_modifier = tengri_pali_legal_traditions
	remove_country_modifier = tengri_religious_pilgrimages
	remove_country_modifier = tengri_monks_in_capital
	remove_country_modifier = tengri_influx_of_monks
	remove_country_modifier = tengri_shiite_immigration
	remove_country_modifier = support_of_the_khojas
	remove_country_modifier = black_shamanism_modifier
	remove_country_modifier = tengri_animist_pantheon
	remove_country_modifier = zoroastrian_traders
	remove_country_modifier = spread_of_tengri_tea_ceremony
	remove_country_modifier = tengri_tea_ceremony
	remove_country_modifier = tengri_japanese_swordsmithing
	remove_country_modifier = tengri_bow_and_arrow_defended
	remove_country_modifier = tengri_support_of_shamans
	remove_country_modifier = tengri_hindu_conflict
	remove_country_modifier = tengri_hindu_syncretism
	remove_country_modifier = tengri_devout_christian_ruler
	remove_country_modifier = tengri_personal_confessor
	remove_country_modifier = tengri_confucian_administrators
	remove_country_modifier = tengri_traditional_elites_alienated
	remove_country_modifier = tengri_jihad
	remove_country_modifier = tengri_stood_up_for_yassa
	remove_country_modifier = tengri_sufi_teacher
	remove_country_modifier = tengri_qadi
	remove_country_modifier = tengri_religious_influx
	remove_country_modifier = tengri_ibadi_scholars
	remove_country_modifier = tengri_clergy_conflicts
	remove_country_modifier = tengri_shamans_spurned
	clr_country_flag = khojas_established
	clr_country_flag = tengri_christian_devout_court
	clr_ruler_flag = tengri_muslim_ruler_questioned
	if = {
		limit = {
			check_variable = { which = khojas_retained value = 1 }
		}
		set_variable = {
			which = khojas_retained value = 0
		}
	}
}

# country. Spawned when Enforcing Rebel Demands through a Support Rebels-war.
on_enforce_rebel_demands = {
	# ROOT = The winning country
	# FROM = The loosing country
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 3
		}
	}
}

# country
# root = winning country, from = loser country
on_war_won = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
			FROM = { NOT = { religion = ROOT } }
		}
		subtract_variable = {
			which = darkness
			value = 5
		}
	}
}

# country
# root = winning country, from = loser country
on_battle_won_country = {
	if = {
		limit = {
			ROOT = { has_personal_deity = wl_lenus_mars }
		}
		ROOT = { add_yearly_manpower = 0.01 }
	}
	if = {
		limit = {
			FROM = { has_personal_deity = wl_lenus_mars }
		}
		FROM = { add_yearly_manpower = 0.01 }
	}
	if = {
		limit = {
			has_country_modifier = glory_charge
		}
		if = {
			limit = {
				has_country_modifier = wl_charge_power_3
				NOT = { has_country_modifier = wl_charge_power_4 }
			}
			add_country_modifier = {
				name = wl_charge_power_4
				duration = 183
			}
		}
		if = {
			limit = {
				has_country_modifier = wl_charge_power_2
				NOT = { has_country_modifier = wl_charge_power_3 }
			}
			add_country_modifier = {
				name = wl_charge_power_3
				duration = 183
			}
		}
		if = {
			limit = {
				has_country_modifier = wl_charge_power_1
				NOT = { has_country_modifier = wl_charge_power_2 }
			}
			add_country_modifier = {
				name = wl_charge_power_2
				duration = 183
			}
		}
		if = {
			limit = {
				NOT = { has_country_modifier = wl_charge_power_1 }
			}
			add_country_modifier = {
				name = wl_charge_power_1
				duration = 183
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				tag = ALB
				NOT = { has_country_flag = albanian_victory }
			}
			FROM = {
				tag = TUR
			}
		}
		ROOT = { set_country_flag = albanian_victory }
	}
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}		
}

# country
# root = loser country, from = winner country
on_battle_lost_country = {
	battle_cult_spreading_effect = yes #Scripted effect for fetishist cult mechanics.
	random_events = {
		90 = 0
		10 = friendship_events.1 #Historical Friendship Broken
	}
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 1
		}
	}
}

#Unit Scope OnAction for Battle Won
on_battle_won_unit = {
	if = {
		limit = {
			has_personal_deity = wl_camulus_mars
			is_ruler_commanding_unit = yes
		}
		unit_owner = { legitimacy = 3 }
	}
	if = {
		limit = {
			unit_owner = { ai = no } #Scopes to Unit Owner from Unit Scope
			general_with_steam_name = yes #Unit Scope Trigger
		}
		unit_owner = { set_country_flag = general_with_steam_name_won_battle }
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
		}
		unit_owner = {
			change_variable = {
				which = DamarwulanWinVariable 
				value = 1
			}
		}
	}
	if = {
		limit = {
			general_with_name = "Damarwulan"
			unit_owner = {
				check_variable = {
					which = DamarwulanWinVariable
					value = 5
				}
			}
		}
		unit_owner = {
			country_event = { id = majapahit.2 days = 2 }
		}
	}
	if = {
		limit = {
			unit_owner = {
				mission_completed = son_military_expertise
				NOT = { mission_completed = son_win_battles }
			}
		}
		unit_owner = {
			change_variable = {
				which = son_fight_counter
				value = 1
			}
		}
		if = {
			limit = {
				is_ruler_commanding_unit = yes
			}
			unit_owner = {
				change_variable = {
					which = son_fight_counter
					value = 1
				}
			}
		}
	}
}

# country
# root = winning country, from = location
on_siege_won_country = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}
	if = {
		limit = {
			is_in_war = {
				casus_belli = cb_berber_settle
			}
		}
		if = {
			limit = {
				ROOT = { NOT = { is_core = FROM } }
				ROOT = {
					any_ally = { is_core = FROM }
				}
			}
			random_ally = {
				limit = {
					is_core = FROM
				}
				FROM = { cede_province = PREV }
			}
		}
		if = {
			limit = {
				NOT = { ROOT = { any_ally = { is_core = FROM } } }
			}
			FROM = { cede_province = ROOT }
		}
		FROM = { add_scaled_local_adm_power = 10 }
	}
	if = {
		limit = {
			religion = hypturism
		}
		random = {
			chance = 10
			ROOT = { save_global_event_target_as = slave_raiding_nat}
			FROM = {
				save_global_event_target_as = slave_raided_prov
				province_event = { id = SLAVERYBAD.2 }
			}
		}
	}
	grant_manpower_from_capital_slave_raid = yes
	events = {
		flavor_oir.5 # Oirats capture Beijing
		flavor_lna.1 # Emerald Buddha
		flavor_son.14 # Djenne surrenders to Songhai Trigger
	}
	random_events = {
		10 = army_professionalism_events.1 #City Sacked
		100 = 0
	}
}
on_new_monarch = {
	events = {
		CBFlavorEvents.16 #Writing conventions of Galagne
	}
	events = {
		CBFlavorEvents.3		#The Nepopteia of New Ruler
	}
}

on_new_consort = {
	country_event = { id = consort_events.2 }
	if = {
		limit = { has_ruler_flag = had_10_years_anniversary }
		clr_ruler_flag = had_10_years_anniversary
	}
	if = {
		limit = { has_ruler_flag = had_20_years_anniversary }
		clr_ruler_flag = had_20_years_anniversary
	}
	if = {
		limit = { has_ruler_flag = consort_had_affection_of_ruler }
		clr_ruler_flag = consort_had_affection_of_ruler
	}
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	random_events = {
		1000 = 0
		25 = polynesian.16 #fijian marriage
	}
}

# country
on_monarch_death = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 5
		}
	}
	if = {
		limit = {
			has_country_flag = axrotalus_rules
		}
		country_event = {
			id = armoricaCoup.2
		}
		clr_country_flag = axrotalus_rules
	}
	if = {
		limit = {
			tag = ANS
			BRA = {
				has_country_flag = albrecht_achilles_flag
			}
		}
		BRA = {
			clr_country_flag = albrecht_achilles_flag #Just to be sure
			kill_heir = {} #If Albrecht Achilles dies in Ansbach he will also be dead in Brandenburg, will appear as normal death of heir to BRA.
		}
	}
	if = {
		limit = { has_country_modifier = sought_after_bachelor }
		remove_country_modifier = sought_after_bachelor
	}
	events = {
		sebkhEvents.1 #The Tragedy of Burzafrah's Demise
		majapahit.8 # Majapahit pretenders
		flavor_mal.11 # Mali pretenders
		flavor_mal.47 # Pilgrimage ends prematurely
	}
}

# country
on_regent = {
	events = {
		tribal_succession.1	# harsh anti-tribals.
		flavor_daimyo.4			#Shiba Yoshikado
		ripkhanate.0		#Christianity Besieged: End of the Ilkhanate
	}
}

# country
on_extend_regency = {
}

# country
on_new_term_election = {
	events = {
		700		# Election event
		elections.720		# Dutch Republic
		elections.800	# Lottery election
		pirates.1
		iskandaria.7	#Christianity Besieged: Iskandaria
	}
}

# country
on_death_election = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 5
		}
	}
	if = {
		limit = { has_reform = presidential_despot_reform }
		remove_government_reform = presidential_despot_reform
	}
	if = {
		limit = {
			has_reform = pirate_republic_reform
		}
		set_country_flag = pirate_death_election
		country_event = { id = pirates.1 }
	}
	events = {
		701		# Election event
		elections.721		# Dutch Republic
		elections.800	# Lottery election
		flavor_tus.16 #Savonarola Leaves This World
		veniceElection.0 #Christianity Besieged: Venetian Elections
		iskandaria.7
	}
}

# country
on_death_foreign_slave_ruler = {
	events = {
		mamluk_events.0 # Choose new ruler
	}
}

# country
on_replace_governor = {
	events = {
		elections.707
	}
}


# country
on_bankruptcy = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 5
		}
	}
}

# country (country annexing, root = target)
on_diplomatic_annex = {
	events = {
		610
	}
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		subtract_variable = {
			which = darkness
			value = 2
		}
	}
}

# country
on_heir_death = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 3
		}
	}
	if = {
		limit = { has_country_flag = heir_dip_education }
		clr_country_flag = heir_dip_education
	}
	if = {
		limit = { has_country_flag = heir_mil_education }
		clr_country_flag = heir_mil_education
	}
	if = {
		limit = { has_country_flag = heir_adm_education }
		clr_country_flag = heir_adm_education
	}
	if = {
		limit = { has_ruler_flag = well_advised_tutored_heir }
		clr_ruler_flag = well_advised_tutored_heir
	}
	if = {
		limit = { has_ruler_flag = heir_went_on_grand_tour }
		clr_ruler_flag = heir_went_on_grand_tour
	}
	if = {
		limit = { has_country_flag = albrecht_achilles_flag }
		clr_country_flag = albrecht_achilles_flag #Death of original Albrecht Achilles
	}
	if = {
		limit = { has_ruler_flag = sancaga_cikma }
		clr_ruler_flag = sancaga_cikma
		every_owned_province = {
			limit = {
				has_province_modifier = heir_in_training
			}
			remove_province_modifier = heir_in_training
		}
	}
	if = {
		limit = { has_ruler_flag = returned_from_sancaga_sikma_province }
		clr_ruler_flag = returned_from_sancaga_sikma_province
	}
	ladislaus_postumus_heir_died_effect = yes
	if = {
		limit = { primary_culture = maori }
		country_event = { id = polynesian.26 }
	}
	if = {
		limit = { has_any_heir_cult_active = yes }
		remove_heir_cult = yes
	}
}

# country
on_queen_death = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		change_variable = {
			which = darkness
			value = 3
		}
	}
	if = {
		limit = { has_consort_flag = 10_years_anniversary }
		set_ruler_flag = had_10_years_anniversary
	}
	if = {
		limit = { has_consort_flag = 20_years_anniversary }
		set_ruler_flag = had_20_years_anniversary
	}
	if = {
		limit = { has_consort_flag = consort_has_affection_of_ruler }
		set_ruler_flag = consort_had_affection_of_ruler
	}

	if = {
		limit = {
			has_regency = no
			NOT = { has_ruler_flag = widow_widower }
		}
		set_ruler_flag = widow_widower
	}
	if = {
		limit = { has_consort_regency = no }
		random_owned_province = {
			limit = { has_province_modifier = domain_of_spouses_family }
			remove_province_modifier = domain_of_spouses_family
		}
	}
	if = {
		limit = { has_ruler_flag = accepted_help_from_spouses_family }
		clr_ruler_flag = accepted_help_from_spouses_family
	}
	if = {
		limit = { has_ruler_flag = helped_spouses_family }
		clr_ruler_flag = helped_spouses_family
	}
	if = {
		limit = { has_ruler_flag = refused_to_help_spouses_family }
		clr_ruler_flag = refused_to_help_spouses_family
	}
	if = {
		limit = { has_ruler_flag = has_lowborn_consort }
		random_owned_province = {
			limit = { has_province_modifier = home_of_consort }
			remove_province_modifier = home_of_consort
		}
	}
	if = {
		limit = { has_ruler_flag = has_lowborn_consort }
		clr_ruler_flag = has_lowborn_consort
	}
	if = {
		limit = { has_country_modifier = consort_adm_advice }
		remove_country_modifier = consort_adm_advice
	}
	if = {
		limit = { has_country_modifier = consort_dip_advice }
		remove_country_modifier = consort_dip_advice
	}
	if = {
		limit = { has_country_modifier = consort_mil_advice }
		remove_country_modifier = consort_mil_advice
	}
	if = {
		limit = { has_country_modifier = without_spouse_advice }
		remove_country_modifier = without_spouse_advice
	}
	if = {
		limit = { has_ruler_modifier = affectionate_royal_couple }
		remove_country_modifier = affectionate_royal_couple
	}
	if = {
		limit = { has_ruler_modifier = bav_woman_scorned_mod }
		remove_country_modifier = bav_woman_scorned_mod
	}
	if = {
		limit = { has_ruler_modifier = bav_building_wife_church }
		remove_country_modifier = bav_building_wife_church
	}
	clr_ruler_flag = marriage_length
}

# country
on_new_heir = {
	if = {
		limit = { has_any_heir_cult_active = yes }
		remove_heir_cult = yes
	}
	if = {
		limit = {
			has_country_flag = enabled_cult_for_heirs
		}
		country_event = {
			id = fetishist_flavor.600
		}
	}
	if = {
		limit = {
			has_country_flag = had_bmv
		}
		clr_country_flag = had_bmv
	}
}

# country
on_weak_heir_claim = {
	events = {
		611		# Pretenders rise up
	}
}

# country : no heir in theocracy
on_heir_needed_theocracy = {
	if = {
		limit = {
			NOT = {
				OR = {
					has_reform = tribal_theocracy
					has_reform = mudarian_utopia
				}
			}
		}	
		country_event = { id = theocracy.1 }
	}
}

# Emperor from same dynasty
on_successive_emperor = {
	emperor = {
		save_global_event_target_as = Emperor
	}
	events = {
		900
	}
}

# Called whenever a new emperor is elected
# FROM = Previous Emperor
# ROOT = New Emperor 
on_emperor_elected = {
	every_elector = {
		if = {
			limit = {
				preferred_emperor = root
			}
			change_variable = {
				which = supported_successive_emperors
				value = 1
			}
		}
		else = {
			set_variable = {
				which = supported_successive_emperors
				value = 0
			}
		}
	}

	emperor = {
		save_global_event_target_as = Emperor
	}
	FROM = {
		if = {
			limit = { has_country_modifier = diet_occupied }
			remove_country_modifier = diet_occupied
			ROOT = {
				add_country_modifier = { name = diet_occupied duration = -1 }
			}
		}
		if = {
			limit = {
				any_country = {
					reverse_has_opinion_modifier = {
						modifier = opinion_imperial_diplomacy
						who = prev
					}
				}
			}
			every_country = {
				limit = {
					reverse_has_opinion_modifier = {
						modifier = opinion_imperial_diplomacy
						who = prev
					}
				}
				reverse_remove_opinion = {
					modifier = opinion_imperial_diplomacy
					who = prev
				}
				ROOT = {
					add_opinion = {
						modifier = opinion_imperial_diplomacy
						who = prev
					}
				}
			}
		}
	}
}

# HRE Prince released by the emperor
on_released_hre_member = {
	events = {
	}
}

# HRE Prince converts to non-Emperor religion
on_hre_member_false_religion = {
	events = {
	}
}

# HRE Prince converts to Emperor religion
on_hre_member_true_religion = {
	events = {
	}
}

# Emperor wins HRE defensive war
on_hre_wins_defensive_war = {
	events = {
	}
}

# HRE member annexed by non-HRE country
on_hre_member_annexed = {
	events = {
	}
}

# HRE member released from non-HRE vassalage
on_hre_released_vassal = {
	events = {
	}
}

# HRE member transferred from non-HRE vassalage to Emperor
on_hre_transfered_vassal = {
	events = {
	}
}

# Emperor coming to the defense of a HRE member
on_hre_defense = {
	events = {
	}
}

# Emperor NOT coming to the defense of a HRE member
on_hre_non_defense = {
	events = {
		909
	}
}

# HRE Member takes a HRE province from an outs100e country in a peace (province scope)
on_hre_province_reconquest = {
	events = {
	}
}

on_lock_hre_religion = {
	events = {
		religious_leagues.1
		religious_leagues.8
	}
}

on_change_hre_religion = {
	events = {
		religious_leagues.2
		religious_leagues.3
	}
}

on_hre_religion_white_peace = {
	events = {
		religious_leagues.4
	}
}

# When a non-native changes government type
on_government_change = {
	clr_country_flag = pirate_mutineer_council
	clr_country_flag = caretaker_revolutionary_government
	if = {
		limit = {
			NOT = { government = monarchy }
			any_owned_province = {
				has_province_modifier = domain_of_spouses_family
			}
		}
		random_owned_province = {
			limit = { has_province_modifier = domain_of_spouses_family }
			remove_province_modifier = domain_of_spouses_family
		}
	}
	if = {
		limit = {
			NOT = { government = monarchy }
			any_owned_province = {
				has_province_modifier = home_of_consort
			}
		}
		random_owned_province = {
			limit = { has_province_modifier = home_of_consort }
			remove_province_modifier = home_of_consort
		}
	}
	if = {
		limit = {
			OR = {
				tag = ENG
				tag = GBR
			}
			any_owned_province = {
				has_province_modifier = rotten_borough
			}
		}
		every_owned_province = {
			limit = {
				has_province_modifier = rotten_borough
			}
			remove_province_modifier = rotten_borough
		}
	}
	if = {
		limit = { has_country_modifier = the_reign_of_terror }
		remove_country_modifier = the_reign_of_terror
	}
	if = {
		limit = {
			has_global_flag = great_peasants_war_flag
			is_part_of_hre = yes
			has_reform = peasants_republic
		}
		1 = {
			change_variable = {
				which = GPW_counting_variable
				value = -3
			}
		}
	}
}

# When a native changes government after filling all their advancement groups.
on_native_change_government = {
}

# Nation is integrated after being in union
on_integrate = {
	events = {
		610
	}
}

# Nation annexed.
# FROM is the nation being annexed
on_annexed = {
	events = {
		celestial_empire_events.1 # Empire dismantled
	}
	on_annexed_estate_privileges_effect = yes
	FROM = {
		if = {
			limit = { is_emperor_of_china = yes }
			dismantle_empire_of_china = yes
			set_global_flag = empire_of_china_dismantled
		}
		if = {
			limit = { has_country_modifier = legatus_natus }
			remove_country_modifier = legatus_natus
			set_global_flag = no_legatus_natus
		}
		if = {
			limit = { has_country_modifier = primas_germaniae }
			remove_country_modifier = primas_germaniae
			set_global_flag = no_primas_germaniae
		}
	}
}

# When the chinese empire gets dismantled (e.g. when the emperor is annexed)
# FROM = Emperor, ROOT = Current Nation
on_chinese_empire_dismantled = {
	clear_global_event_target = EmperorOfChina
	events = {
	}
}

# When a nation gains the Mandate of Heaven (becomes the Emperor of China)
# FROM = Old Emperor, ROOT = New Emperor
on_mandate_of_heaven_gained = {
	save_global_event_target_as = EmperorOfChina
	if = {
		limit = {
			technology_group = nomad_group
		}
		change_technology_group = chinese
		change_unit_type = chinese
	}
	if = {
		limit = {
			OR = {
				NOT = { government = monarchy }
				government = tribal
			}
		}
		change_government_to_monarchy = yes
	}
	add_government_reform = celestial_empire
	set_mandate = 60
	set_meritocracy = 60
	add_country_modifier = {
		name = new_mandate_holder
		duration = 9125
	}
	1816 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	1821 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	667 = {
		if = {
			limit = {
				NOT = { owned_by = root }
				NOT = { is_core = root }
			}
			add_core = root
		}
	}
	china_superregion = {
		limit = {
			NOT = { is_core = ROOT }
		}
		add_permanent_claim = ROOT
	}
	if = {
		limit = {
			has_dlc = "Mandate of Heaven"
		}
		remove_faction = temples
		remove_faction = enuchs
		remove_faction = bureaucrats
	}
	if = {
		limit = {
			has_country_modifier = lost_mandate_of_heaven
		}
		remove_country_modifier = lost_mandate_of_heaven
	}
	country_event = { #Reforming the Bureaucracy
		id = china_events.31
		days = 365
	}
	country_event = {
		id = china_events.32 #Records of the last Empire
		days = 183
	}
	country_event = {
		id = celestial_empire_events.2
		days = 1825
	}
}

# When a nation loses the Mandate of Heaven
# FROM = New Emperor, ROOT = Old Emperor
on_mandate_of_heaven_lost = {
	remove_government_reform = celestial_empire
	set_government_rank = 2
	add_country_modifier = {
		name = lost_mandate_of_heaven
		duration = 7300	# 20 years
	}
	add_stability = -2
	china_superregion = {
		limit = {
			is_permanent_claim = ROOT
		}
		remove_claim = ROOT
	}
	if = {
		limit = {
			has_country_modifier = new_mandate_holder
		}
		remove_country_modifier = new_mandate_holder
	}
}

on_embrace_revolution = {
	if = {	
		limit = {
			any_subject_country = {
				has_country_modifier = colony_inspired_by_revolution
			}
		}
		every_subject_country = {
			remove_country_modifier = colony_inspired_by_revolution
		}
	}
	if = {
		limit = { NOT = { government = republic } }
		change_government_to_republic = yes
	}
	if = {
		limit = { 
			revolution_target_exists = no
			is_great_power = yes
		}
		set_revolution_target = ROOT
		add_government_reform = revolutionary_republic_reform
		if = {
			limit = {
				any_country = {
					has_country_flag = last_revolutionary_country
				}
			}
			every_country = {
				limit = {
					has_country_flag = last_revolutionary_country
				}
				clr_country_flag = last_revolutionary_country
			}
		}
	}
	else = {
		add_government_reform = junior_revolutionary_republic_reform
	}
	if = {
		limit = { has_reform = parliamentary_reform }
		remove_government_reform = parliamentary_reform
	}
	kill_ruler = yes
	set_country_flag = revolutionary_republic_flag
	set_country_flag = had_revolution
}

# THIS = Revolutionary country being beaten, FROM = Country enforcing the peace treaty
on_dismantle_revolution = {
	events = {
		center_of_revolution.1500
	}
	if = {
		limit = {
			any_country = {
				has_country_flag = last_revolutionary_country
			}
		}
		every_country = {
			limit = {
				has_country_flag = last_revolutionary_country
			}
			clr_country_flag = last_revolutionary_country
		}
	}
	set_country_flag = last_revolutionary_country
}

# province
on_adm_development = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		ROOT = {
			subtract_variable = {
				which = darkness
				value = 1
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_mag_mater
			}
		}
		if = {
			limit = {
				NOT = { has_province_modifier = wl_mothers_fortunes }
			}
			ROOT = { add_adm_power = 25 }
			add_province_modifier = {
				name = wl_mothers_fortunes
				duration = 1825
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_venus
				NOT = { has_country_modifier = wl_fortuitous_cd }
			}
		}
		ROOT = {
			add_country_modifier = {
				name = wl_fortuitous_cd
				duration = 182
			}
		}
		add_base_tax = 1
	}
}

# province
on_dip_development = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		ROOT = {
			subtract_variable = {
				which = darkness
				value = 1
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_camulus_mars
			}
			NOT = { has_province_modifier = wl_cams_game_dev_prov }
		}
		add_country_modifier = {
				name = wl_cams_game_dev_prov
				duration = 182
		}
		if = {
			limit = {
				ROOT = {
					num_of_owned_provinces_with = {
						amount = 3
						has_province_modifier = wl_cams_game_dev_prov
					}
					NOT = { has_country_modifier = wl_cams_game_dev }
				}
			}
			add_country_modifier = {
				name = wl_cams_game_dev
				duration = 182
			}
		}
	}
}

# province
on_mil_development = {
	if = {
		limit = {
			ROOT = { has_darkness = yes }
		}
		ROOT = {
			subtract_variable = {
				which = darkness
				value = 1
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_epona
			}
			NOT = { has_country_modifier = wl_horseriding_festival_3 }
			has_country_modifier = wl_horseriding_festival_2
		}
		ROOT = {
			add_country_modifier = {
				name = wl_horseriding_festival_3
				duration = 182
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_epona
			}
			NOT = { has_country_modifier = wl_horseriding_festival_2 }
			has_country_modifier = wl_horseriding_festival_1
		}
		ROOT = {
			add_country_modifier = {
				name = wl_horseriding_festival_2
				duration = 182
			}
		}
	}
	if = {
		limit = {
			ROOT = {
				religion = walianitas
				has_personal_deity = wl_epona
			}
			NOT = { has_country_modifier = wl_horseriding_festival_1 }
		}
		ROOT = {
			add_country_modifier = {
				name = wl_horseriding_festival_1
				duration = 182
			}
		}
	}
}

on_bi_yearly_pulse_3 = {

	#Fire estate agenda if you have that privilege
	# NOTE DOING THIS THROUGH RANDOM EVENT NOW WITH estate_privileges_and_agendas_events.4 INSTEAD!
	#on_bi_yearly_pulse_estate_privileges_effect = yes

	events = {
		muslim_school_events.20 #Pick School
	}
	random_events = {
		100 = CBFlavorEvents.6 #Christianity Besieged: Hellenic missionary

		200 = 0
	}
}

on_become_free_city = {
	events = {
		free_cities.1
	}
}

on_remove_free_city = {
	events = {
		free_cities.2
	}
}

on_fetishist_cult_change = {
	country_event = { id = fetishist_flavor.302 days = 10 } #removing tomb if incompatible cult is picked
	country_event = { id = fetishist_flavor.304 days = 10 } #rebuilding tomb if lost
	if = {
		limit = {
			has_country_flag = lost_ancestral_lands
			NOT = { has_adopted_cult = zanahary_cult }
			NOT = { has_adopted_cult = central_african_ancestor_cult }
		}
		clr_country_flag = lost_ancestral_lands
	}
}

# country
on_gain_great_power_status = {
	if = {
		limit = {
			NOT = { has_country_flag = became_great_power_flag }
		}
		set_country_flag = became_great_power_flag
	}
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 3
		}
	}
}

# country
on_lose_great_power_status = {
	if = {
		limit = {
			has_darkness = yes
		}
		change_variable = {
			which = darkness
			value = 3
		}
	}
}

# province
on_province_culture_converted = {
	on_province_culture_converted_estate_privilges_effect = yes
	# judaism_on_province_culture_converted_effect = yes
	# kongo_on_province_change_culture_or_change_owner_effect = yes
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 4
		}
	}
	remove_province_modifier = carnaro_village_privileges
	if = {
		limit = { has_province_modifier = naghali_discontent }
		remove_province_modifier = naghali_discontent
	}
}

on_province_owner_change = {
	if = {
		limit = {
			FROM = { has_country_flag = naghali_repression }
			NOT = { has_province_modifier = naghali_discontent }
		}
		add_permanent_province_modifier = {
			name = naghali_discontent
			duration = -1
		}
	}
	if = {
		limit = {
			FROM = { has_country_flag = naghali_enfranchisement }
			has_province_modifier = naghali_discontent
		}
		add_permanent_province_modifier = {
			name = naghali_discontent
			duration = -1
		}
	}
}

# country
on_harmonized_tengri_pagan_reformed = {
	events = {
		more_confucian.1
	}
}
on_harmonized_hellenic = {
	events = {
		more_confucian.2
	}
}
on_harmonized_american_pagan = {
	events = {
		more_confucian.3
	}
}
on_harmonized_slavic_pagan = {
	events = {
		more_confucian.4
	}
}
on_harmonized_german_pagan = {
	events = {
		more_confucian.5
	}
}
on_harmonized_african_pagan = {
	events = {
		more_confucian.6
	}
}
on_harmonized_pagan = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.1
	}
}
on_harmonized_christian = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.2
	}
}
on_harmonized_muslim = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.3
	}
}
on_harmonized_jewish_group = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.5
	}
}
on_harmonized_zoroastrian_group = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.6
	}
}
on_harmonized_dharmic = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.4
	}
}
on_harmonized_mahayana = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.9
	}
}
on_harmonized_buddhism = { #Theravada
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.8
	}
}
on_harmonized_shinto = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.7
	}
}
on_harmonized_vajrayana = {
	on_harmonized_religion_estate_privileges_effect = yes
	events = {
		confucian_events.10
	}
}

# country
on_general_recruited = {
	add_army_professionalism = 0.01
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}
}

# country
on_admiral_recruited = {
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}
}

# country
on_conquistador_recruited = {
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}
}

# country
on_explorer_recruited = {
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 1
		}
	}
}

# THIS = Province, FROM = Country, ROOT = Merc Unit
on_mercenary_recruited = {
	if = {
		limit = {
			OR = {
				FROM = { NOT = { has_country_flag = oyo_cavalry_do_not_consume_ap } }
				ROOT = { NOT = { mercenary_company = merc_oyo_cavalry } }
			}
		}
		FROM = {
			add_army_professionalism = -0.05
		}
	}
}


on_reform_changed = {
	if = {
		limit = {
			has_country_modifier = rome_respecting_venetia
			NOT = { has_reform = privilegiis_venetia }
		}
		add_stability = -2
		remove_country_modifier = rome_respecting_venetia
		VEN = {
			add_country_modifier = {
				name = rebellious_venetia
				duration = 10950
			}
		}
	}
}

on_trade_company_investment = {
}

on_culture_promoted = {
	on_culture_promoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	
	if = { 
		limit = { has_country_flag = reduce_ae_from_prom_cultures_flag }
		every_country = {
			add_aggressive_expansion = {
				who = ROOT 
				value = -3
				apply_calc = no 
			}
		}
	}
	if = {
		limit = {
			has_darkness = yes
		}
		subtract_variable = {
			which = darkness
			value = 5
		}
	}
}

on_culture_demoted = {
	on_culture_demoted_estate_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_culture_country_effect = yes
	on_culture_demoted_effect = yes
}

on_primary_culture_changed = {
	on_primary_culture_changed_privileges_effect = yes
	judaism_on_culture_country_effect = yes
	imperial_modifiers_on_primary_culture_change_effect = yes
}

# ROOT = New vassal, FROM = Overlord
on_create_vassal = {
	if = {
		limit = {
			FROM = { has_personal_deity = wl_lenus_mars }
		}
		FROM = { add_prestige = 5 }
	}
	if = {
		limit = {
			tag = BTA
		}
		change_government = theocracy
		change_religion = ashabi
		add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
}

# THIS = Raiding country, FROM = Sea province
on_raid_coast = {
	if = {
		limit = {
			FROM = {
				any_neighbor_province = {
					owned_by = BTA
				}
			}
		}
		BTA = { set_country_flag = kursikan_raided_coasts }
	}
}

# this = Released country, FROM = Releasing country
on_country_released = {
	if = {
		limit = {
			tag = BTA
		}
		change_government = theocracy
		change_religion = ashabi
		add_government_reform = papacy_reform
		adopt_reform_progress = FROM
	}
	if = {
		limit = {
			FROM = { has_reform = religious_permanent_revolution_reform }
			NOT = { tag = BTA }
		}
		change_religion = FROM
		adopt_reform_progress = FROM
		add_country_modifier = {
			name = global_holy_war_released_modifier
			duration = 3650
			hidden = yes
		}
		capital_scope = {
			change_religion = FROM
		}
	}
}

# this = new client state, from = parent country
on_create_client_state = {
	if = {
		limit = {
			FROM = { has_personal_deity = wl_lenus_mars }
		}
		FROM = { add_prestige = 5 }
	}
}


# province:  spawned whenever a new owner takes over the province
# FROM = The previous owner.
on_conquest = {
	remove_named_unrest = estate_land_seized
	clr_province_flag = has_estate_unrest_flag
	if = {
		limit = {
			ROOT = {
				religion = hypturism
			}
		}
		random = {
			chance = 10
			change_trade_goods = slaves
		}
	}
}

on_country_creation = {
	if = {
		limit = {
			tag = BTA
			OR = {
				NOT = {
					religion = ashabi
				}
				NOT = {
					has_reform = papacy_reform
				}
				NOT = {
					government = theocracy
				}
			}
		}
		change_religion = ashabi
		change_government = theocracy
		add_government_reform = papacy_reform
	}
}

on_federation_leader_change = {
	if = {
		limit = { tag = FROM }
		disband_federation = THIS
	}
	else = {
		# New strongest member becomes the new federation leader
		set_federation_leader = THIS
	}
}

#FROM = country pillaged, ROOT = country doing the pillaging
on_pillaged_capital = {
	slave_raid_pillage_capital_effect = yes
	if = {
		limit = { has_darkness = yes }
		if = {
			limit = { tag = FROM }
			change_variable = {
       				which = darkness
       				value = 5
			}
		}
		if = {
			limit = { tag = ROOT }
			subtract_variable = {
       				which = darkness
       				value = 3
			}
		}
	}
}

#ROOT = converted country, FROM = country which force converts ROOT, on_action gets called on Force religion peace and Enforce Religion subject interaction
on_force_conversion = {
	if = {
		limit = {
			FROM = { religion = ashabi }
		}
		if = {
			limit = { ROOT = { government_rank = 3 } }
			FROM = { add_papal_influence = 20 }
		}
		else_if = {
			limit = { ROOT = { government_rank = 2 } }
			FROM = { add_papal_influence = 10 }
		}
		else = {
			FROM = { add_papal_influence = 5 }
		}
	}
}
