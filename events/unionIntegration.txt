namespace = unionIntegration
country_event = {
	id = unionIntegration.0
	title = unionIntegration.t
	desc = {
		trigger = { has_country_flag = north_iberian_union }
		desc = unionIntegration.d1
	}
	desc = {
		trigger = { has_country_flag = central_iberian_union }
		desc = unionIntegration.d2
	}
	desc = {
		trigger = { has_country_flag = south_iberian_union}
		desc = unionIntegration.d3
	}
	desc = {
		trigger = { has_country_flag = intercacia_iberian_union }
		desc = unionIntegration.d4
	}
	desc = {
		trigger = { has_country_flag = callaeci_iberian_union }
		desc = unionIntegration.d5
	}
	is_triggered_only = yes
	immediate = {
		hidden_effect = {
			if = {
				limit = {
					OR = {
						CNT = { is_subject_of = ROOT }
						CNT = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = central_iberian_union }
				}
				CNT = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = CNT
			}
			if = {
				limit = {
					OR = {
						LUS = { is_subject_of = ROOT }
						LUS = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = callaeci_iberian_union }
				}
				LUS = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = LUS
			}
			if = {
				limit = {
					OR = {
						ASU = { is_subject_of = ROOT }
						ASU = { alliance_with = ROOT }
					}
				}
				ASU = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				inherit = ASU
				}
			}
			if = {
				limit = {
					OR = {
						VCC = { is_subject_of = ROOT }
						VCC = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = callaeci_iberian_union }
				}
				VCC = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = VCC
			}
			if = {
				limit = {
					OR = {
						VTT = { is_subject_of = ROOT }
						VTT = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = north_iberian_union }
				}
				VTT = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = VTT
			}
			if = {
				limit = {
					OR = {
						TRD = { is_subject_of = ROOT }
						TRD = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = north_iberian_union }
					NOT = { has_country_flag = central_iberian_union }
				}
				TRD = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = TRD
			}
			if = {
				limit = {
					OR = {
						INT = { is_subject_of = ROOT }
						INT = { alliance_with = ROOT }
					}
				}
				INT = {
					every_owned_province = {
						set_local_autonomy = 95
					}
				}
				inherit = INT
			}
			if = {
				limit = {
					OR = {
						CIT = { is_subject_of = ROOT }
						CIT = { alliance_with = ROOT }
					}
				}
				CIT = {
					every_owned_province = {
						set_local_autonomy = 95
					}
					inherit = CIT
				}
			}
			if = {
				limit = {
					OR = {
						GAL = { is_subject_of = ROOT }
						GAL = { alliance_with = ROOT }
					}
					NOT = { has_country_flag = south_iberian_union }
				}
				GAL = {
					every_owned_province = {
						limit = {
							NOT = { local_autonomy = 95 }
						}
						set_local_autonomy = 95
					}
				}
				inherit = GAL
			}
		}
	}
	option = { #We will give them the autonomy they desire
		name = unionIntegration.a
		custom_tooltip = iberian_union_liked_that
		add_stability = 1
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = north_iberian_union
				}
				release = VTT
				create_march = VTT
				release = TRD
				reverse_add_opinion = {
					who = TRD
					modifier = appreciate_iberian_autonomy
				}
				reverse_add_opinion = {
					who = VTT
					modifier = appreciate_iberian_autonomy
				}
			}
			if = {
				limit = {
					has_country_flag = central_iberian_union
				}
				release = TRD
				create_march = TRD
				release = CNT
				reverse_add_opinion = {
					who = TRD
					modifier = appreciate_iberian_autonomy
				}
				reverse_add_opinion = {
					who = CNT
					modifier = appreciate_iberian_autonomy
				}
			}
			if = {
				limit = {
					has_country_flag = south_iberian_union
				}
				reverse_add_opinion = {
					who = GAL
					modifier = appreciate_iberian_autonomy
				}
				release = GAL
			}
			if = {
				limit = {
					has_country_flag = callaeci_iberian_union
				}
				release = LUS
				release = VCC
				create_subject = {
					subject_type = march
					subject = LUS
				}
				reverse_add_opinion = {
					who = LUS
					modifier = appreciate_iberian_autonomy
				}
				reverse_add_opinion = {
					who = VCC
					modifier = appreciate_iberian_autonomy
				}
			}
			if = {
				limit = {
					has_country_flag = intercacia_iberian_union
				}
				add_dip_power = -50
				every_known_country = {
					limit = {
						religion_group = muslim
						capital_scope = {
							region = iberia_region
						}
					}
					add_opinion = {
						who = IBE
						modifier = appreciate_iberian_autonomy
					}
				}
				reverse_add_opinion = {
					who = BTA
					modifier = appreciate_iberian_autonomy
				}
				reverse_add_opinion = {
					who = IFR
					modifier = appreciate_iberian_autonomy
				}
				if = {
					limit = {
						exists = AGU
						is_neighbor_of = AGU
					}
					every_owned_province = {
						limit = {
							religion_group = muslim
							OR = {
								area = asturias_area
								area = basque_country
								area = aragon_area
								area = galicia_area
							}
						}
						cede_province = AGU
					}
				}
				if = {
					limit = {
						exists = TLD
						is_neighbor_of = TLD
					}
					every_owned_province = {
						limit = {
							religion_group = muslim
							OR = {
								area = castille_area
								area = leon_area
								area = toledo_area
							}
						}
						cede_province = TLD
					}
				}
				if = {
					limit = {
						exists = KSR
						is_neighbor_of = KSR
					}
					every_owned_province = {
						limit = {
							religion_group = muslim
							OR = {
								area = extremadura_area
								area = alentejo_area
								area = beieras_area
							}
						}
						cede_province = KSR
					}
				}
				if = {
					limit = {
						exists = CRD
						is_neighbor_of = CRD
					}
					every_owned_province = {
						limit = {
							religion_group = muslim
							OR = {
								area = lower_andalucia_area
								area = upper_andalucia_area
								area = toledo_area
							}
						}
						cede_province = CRD
					}
				}
				if = {
					limit = {
						exists = MRS
						is_neighbor_of = MRS
					}
					every_owned_province = {
						limit = {
							religion_group = muslim
							area = valencia_area
						}
						cede_province = MRS
					}
				}
			}
		}
		custom_tooltip = iberian_autonomy_consequence
	}

	option = { #Lol yea right
		name = unionIntegration.b
		hidden_effect = {
			if = {
				limit = {
					has_country_flag = north_iberian_union
				}
				TRD = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				VTT = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				inherit = VTT
				inherit = TRD
			}
			if = {
				limit = {
					has_country_flag = central_iberian_union
				}
				TRD = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				CNT = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				inherit = TRD
				inherit = CNT
			}
			if = {
				limit = {
					has_country_flag = south_iberian_union
				}
				GAL = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				inherit = GAL
			}
			if = {
				limit = {
					has_country_flag = callaeci_iberian_union
				}
				LUS = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				VCC = {
					every_owned_province = {
						add_unrest = 10
					}
				}
				inherit = LUS
				inherit = VCC
			}
			if = {
				limit = {
					has_country_flag = intercacia_iberian_union
				}
				every_known_country = {
					limit = {
						religion_group = muslim
						any_owned_province = {
							region = iberia_region
						}
					}
					add_opinion = {
						who = IBE
						modifier = oppressing_aybirean_faithful
					}
				}
				every_owned_province = {
					limit = {
						religion_group = muslim
					}
					add_province_modifier = {
						duration = 1325
						name = oppressed_iberians
					}
				}
			}
		}
		add_prestige = 15
		custom_tooltip = oppressing_aybirean_faithful_tt
	}
}